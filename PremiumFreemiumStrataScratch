/* Premium vs Freemium (stratascratch.com)
Find the total number of downloads for paying and non-paying users by date. Include only records where non-paying customers have more downloads than paying customers. The output should be sorted by earliest date first and contain 3 columns date, non-paying downloads, paying downloads. Hint: In Oracle you should use "date" when referring to date column (reserved keyword).
*/

SELECT date,
    SUM(CASE 
            WHEN paying_customer ='no' 
            THEN downloads ELSE 0 END) AS non_paying, 
    SUM(CASE 
            WHEN paying_customer ='yes' 
            THEN downloads ELSE 0 END) AS paying
FROM ms_user_dimension u 
    JOIN ms_acc_dimension a ON a.acc_id=u.acc_id
    JOIN ms_download_facts f ON f.user_id=u.user_id
GROUP BY date
HAVING non_paying > paying
ORDER BY date ASC;
