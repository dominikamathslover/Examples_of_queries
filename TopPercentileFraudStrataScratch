/*Top Percentile Fraud (stratascratch.com)
We want to identify the most suspicious claims in each state. We'll consider the top 5 percentile of claims with the highest fraud scores in each state as potentially fraudulent.
Your output should include the policy number, state, claim cost, and fraud score.
*/


WITH ranking AS(
SELECT *,
    PERCENT_RANK() OVER(partition by state ORDER BY fraud_score DESC) AS rr
FROM fraud_score)
SELECT  policy_num,
        state,
        claim_cost,
        fraud_score
FROM ranking
WHERE rr<=0.05;
